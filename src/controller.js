
(function(){
    'use strict';
    angular.module('app').controller('appController', function($log, $scope){

        $log.log('Controller initiated');
        var vm= this;
        vm.title = 'Ethereum app';
        vm.contracts = [];
        var Web3 = require('web3');
        var web3 = new Web3();
        if(!web3.currentProvider)
            web3 = new Web3(new web3.providers.HttpProvider("http://localhost:8545"));
            
        $log.log('Web 3 loaded', web3.eth.accounts);
        vm.accounts = web3.eth.accounts;
        var ballot_sol_imsContract = web3.eth.contract([{"constant":false,"inputs":[{"name":"input","type":"address"},{"name":"name_f","type":"string"},{"name":"name_l","type":"string"},{"name":"addr","type":"string"},{"name":"is_pep","type":"bool"}],"name":"addIdentity","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"toVerify","type":"address"}],"name":"verifyIdentity","outputs":[{"name":"isIn","type":"bool"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"isPEP","type":"bool"},{"name":"other","type":"bool"},{"name":"amount","type":"uint16"}],"name":"estimateRisk","outputs":[{"name":"risk","type":"uint16"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"}]);
        vm.mineContract = function(){
            var ballot_sol_ims = ballot_sol_imsContract.new(
        {
            from: web3.eth.accounts[0], 
            data: '0x6060604052341561000c57fe5b5b604060405190810160405280601881526020017f4964656e74697479204d616e6167656d656e7420546f6f6c000000000000000081525060059080519060200190610059929190610060565b505b610105565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106100a157805160ff19168380011785556100cf565b828001600101855582156100cf579182015b828111156100ce5782518255916020019190600101906100b3565b5b5090506100dc91906100e0565b5090565b61010291905b808211156100fe5760008160009055506001016100e6565b5090565b90565b610770806101146000396000f30060606040526000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680635a34c73814610051578063b5b90fd91461015b578063ce1e78e1146101a9575bfe5b341561005957fe5b610159600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803590602001908201803590602001908080601f0160208091040260200160405190810160405280939291908181526020018383808284378201915050505050509190803515159060200190919050506101ff565b005b341561016357fe5b61018f600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506105f9565b604051808215151515815260200191505060405180910390f35b34156101b157fe5b6101e160048080351515906020019091908035151590602001909190803561ffff16906020019091905050610668565b604051808261ffff1661ffff16815260200191505060405180910390f35b600060006000600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160009054906101000a900460ff1615156102615760006000fd5b600060008973ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160009054906101000a900460ff16156102bc5760006000fd5b61032091506102cd84600084610668565b9250868686866040518085805190602001908083835b6020831061030657805182526020820191506020810190506020830392506102e3565b6001836020036101000a03801982511681845116808217855250505050505090500184805190602001908083835b602083106103575780518252602082019150602081019050602083039250610334565b6001836020036101000a03801982511681845116808217855250505050505090500183805190602001908083835b602083106103a85780518252602082019150602081019050602083039250610385565b6001836020036101000a03801982511681845116808217855250505050505090500182151515157f01000000000000000000000000000000000000000000000000000000000000000281526001019450505050506040518091039020905060e06040519081016040528060011515815260200188815260200187815260200186815260200185151581526020018461ffff1681526020016000815250600060008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008201518160000160006101000a81548160ff02191690831515021790555060208201518160010190805190602001906104bf92919061069f565b5060408201518160020190805190602001906104dc92919061069f565b5060608201518160030190805190602001906104f992919061069f565b5060808201518160040160006101000a81548160ff02191690831515021790555060a0820151816005015560c08201518160060155905050606060405190810160405280826000191681526020016001151581526020018461ffff16815250600260008a73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000820151816000019060001916905560208201518160010160006101000a81548160ff02191690831515021790555060408201518160010160016101000a81548161ffff021916908361ffff1602179055509050505b5b5050505050505050565b600060019050600060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160009054906101000a900460ff161561065d5760019050610662565b600090505b5b919050565b600060009050831561067957600a90505b821561068457600590505b6103e88261ffff16111561069757600290505b5b9392505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106106e057805160ff191683800117855561070e565b8280016001018555821561070e579182015b8281111561070d5782518255916020019190600101906106f2565b5b50905061071b919061071f565b5090565b61074191905b8082111561073d576000816000905550600101610725565b5090565b905600a165627a7a72305820f246c7cc3f7b76fcbc0d6d227f7639c5ede53e5ee03ebc2bec5ccbc106bad3050029', 
            gas: '4700000'
        }, function (e, contract){
            console.log(e, contract);
            if (typeof contract.address !== 'undefined') {
                vm.contracts.push(contract);
                console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
                $log.log('Full contract', contract);
                $scope.$apply();
                
            }
        })


        };
                //var code = web3.eth.compile.solidity('../contract.sol')
       // var compiled = web3.eth.compile.solidity(contractSource);

       
        
    })

})();